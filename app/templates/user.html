{% extends 'base.html' %}

{% block content %}
<div class="recommendation-form-container">
    <h2>–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h2>
    <form id="recommendationForm">
        <div class="form-group">
            <label for="weather">–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞</label>
            <select id="weather" name="weather" required>
                <option value="sunny">–°–æ–ª–Ω–µ—á–Ω–æ</option>
                <option value="cloudy">–û–±–ª–∞—á–Ω–æ</option>
                <option value="rainy">–î–æ–∂–¥—å</option>
                <option value="snowy">–°–Ω–µ–≥</option>
                <option value="windy">–í–µ—Ç—Ä–µ–Ω–æ</option>
            </select>
        </div>
        <div class="form-group">
            <label for="timeofday">–í—Ä–µ–º—è –¥–Ω—è</label>
            <select id="timeofday" name="timeofday" required>
                <option value="morning">–£—Ç—Ä–æ</option>
                <option value="afternoon">–î–µ–Ω—å</option>
                <option value="evening">–í–µ—á–µ—Ä</option>
                <option value="night">–ù–æ—á—å</option>
            </select>
        </div>
        <div class="form-group">
            <label for="mood">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
            <input type="text" id="mood" name="mood" readonly placeholder="–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∫–µ—Ç—É –Ω–∏–∂–µ" style="background:#f0f0f0;cursor:not-allowed;">
            <button type="button" id="openMoodModal" style="margin-top:8px;">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</button>
        </div>
        <div class="form-group">
            <label for="time">–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è (–º–∏–Ω—É—Ç)</label>
            <input type="number" id="time" name="time" min="5" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 60">
        </div>
        <div class="form-group">
            <label for="budget">–ë—é–¥–∂–µ—Ç (‚ÇΩ)</label>
            <input type="number" id="budget" name="budget" min="0" step="10" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1000">
        </div>
        <div class="form-group">
            <label for="location">–õ–æ–∫–∞—Ü–∏—è (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ IP, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)</label>
            <div style="display:flex;gap:8px;align-items:center;">
                <input type="text" id="location" name="location" required placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –∏–ª–∏ —Ä–∞–π–æ–Ω" style="flex:1;">
                <button type="button" id="detectLocation" title="–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–æ—Ä–æ–¥" style="padding:8px 14px;font-size:18px;">üìç</button>
            </div>
        </div>
        <button type="submit" class="main-btn">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
    </form>
    <div id="recommendationResult" class="recommendation-result"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è -->
<div id="moodModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('moodModal').style.display='none'">&times;</span>
        <h2>–ê–Ω–∫–µ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h2>
        <form id="moodForm">
            <label>1. –ö–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è?</label>
            <label><input type="radio" name="q1" value="–û—Ç–ª–∏—á–Ω–æ" required/> –û—Ç–ª–∏—á–Ω–æ</label>
            <label><input type="radio" name="q1" value="–•–æ—Ä–æ—à–æ"/> –•–æ—Ä–æ—à–æ</label>
            <label><input type="radio" name="q1" value="–ù–æ—Ä–º–∞–ª—å–Ω–æ"/> –ù–æ—Ä–º–∞–ª—å–Ω–æ</label>
            <label><input type="radio" name="q1" value="–ü–ª–æ—Ö–æ"/> –ü–ª–æ—Ö–æ</label>
            <label>2. –ö–∞–∫–æ–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ–Ω –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç?</label>
            <label><input type="checkbox" name="q2" value="–†–∞–¥–æ—Å—Ç—å"/> –†–∞–¥–æ—Å—Ç—å</label>
            <label><input type="checkbox" name="q2" value="–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ"/> –°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</label>
            <label><input type="checkbox" name="q2" value="–≠–Ω–µ—Ä–≥–∏—è"/> –≠–Ω–µ—Ä–≥–∏—è</label>
            <label><input type="checkbox" name="q2" value="–ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è"/> –ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è</label>
            <label><input type="checkbox" name="q2" value="–£—Å—Ç–∞–ª–æ—Å—Ç—å"/> –£—Å—Ç–∞–ª–æ—Å—Ç—å</label>
            <label>3. –ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω—ã?</label>
            <input type="range" name="q3" min="1" max="10" value="5"/>
            <label>4. –•–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã —á–µ–≥–æ-—Ç–æ –≤–µ—Å–µ–ª–æ–≥–æ –∏–ª–∏ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–µ–≥–æ?</label>
            <select name="q4">
                <option value="–≤–µ—Å–µ–ª–æ–µ">–í–µ—Å–µ–ª–æ–µ</option>
                <option value="—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–µ">–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–µ</option>
                <option value="–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ</option>
            </select>
            <label>5. –ö–∞–∫–æ–π —É –≤–∞—Å —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞?</label>
            <select name="q5">
                <option value="–Ω–∏–∑–∫–∏–π">–ù–∏–∑–∫–∏–π</option>
                <option value="—Å—Ä–µ–¥–Ω–∏–π">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="–≤—ã—Å–æ–∫–∏–π">–í—ã—Å–æ–∫–∏–π</option>
            </select>
            <label>6. –ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –∂–µ–ª–∞–Ω–∏–µ –ø–æ–æ–±—â–∞—Ç—å—Å—è —Å –∫–µ–º-—Ç–æ?</label>
            <select name="q6">
                <option value="–¥–∞">–î–∞</option>
                <option value="–Ω–µ—Ç">–ù–µ—Ç</option>
                <option value="–Ω–µ–≤–∞–∂–Ω–æ">–ù–µ–≤–∞–∂–Ω–æ</option>
            </select>
            <button type="submit" style="margin-top:16px;">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</button>
        </form>
    </div>
</div>

<style>
    .recommendation-form-container {
      max-width: 540px;
      margin: 48px auto 0 auto;
      background: linear-gradient(120deg, #f8f9fa 60%, #e3f0ff 100%);
      border-radius: 20px;
      box-shadow: 0 10px 36px rgba(0,132,240,0.10);
      padding: 38px 32px 28px 32px;
      border: 1.5px solid #e0eaff;
    }
    .recommendation-form-container h2 {
      text-align: center;
      margin-bottom: 28px;
      color: #0084f0;
      font-weight: 900;
      letter-spacing: 1.5px;
      font-size: 2rem;
    }
    .form-group {
      margin-bottom: 22px;
    }
    .form-group label {
      font-weight: 700;
      margin-bottom: 7px;
      display: block;
      color: #005fa3;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 8px;
      border: 1.5px solid #d0d0d0;
      font-size: 16px;
      margin-top: 4px;
      background: #f8f9fa;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .form-group input:focus,
    .form-group select:focus {
      border: 2px solid #0084f0;
      outline: none;
      box-shadow: 0 0 0 2px #e0eaff;
    }
    .main-btn {
      width: 100%;
      background: linear-gradient(90deg, #0084f0 60%, #00c6fb 100%);
      color: #fff;
      font-weight: 800;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      padding: 14px 0;
      margin-top: 10px;
      box-shadow: 0 4px 16px rgba(0,132,240,0.10);
      transition: background 0.2s, transform 0.2s;
      cursor: pointer;
    }
    .main-btn:hover {
      background: linear-gradient(90deg, #005fa3 60%, #0084f0 100%);
      transform: translateY(-2px) scale(1.02);
    }
    #detectLocation {
      background: #e3f0ff;
      border: 1.2px solid #b3d8ff;
      border-radius: 6px;
      color: #0084f0;
      transition: background 0.2s, border 0.2s;
    }
    #detectLocation:hover {
      background: #cbe6ff;
      border: 1.5px solid #0084f0;
    }
    .recommendation-result {
      margin-top: 32px;
      padding: 20px 16px;
      background: #f0f8ff;
      border-radius: 10px;
      color: #005fa3;
      font-size: 18px;
      font-weight: 700;
      display: none;
      box-shadow: 0 2px 8px rgba(0,132,240,0.07);
    }
    /* --- –ö–†–ê–°–ò–í–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û --- */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 132, 240, 0.18);
      backdrop-filter: blur(2.5px);
      animation: modal-fade-in 0.35s cubic-bezier(.4,0,.2,1);
    }
    @keyframes modal-fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: linear-gradient(120deg, #fff 70%, #e3f0ff 100%);
      margin: 60px auto;
      padding: 36px 30px 28px 30px;
      border-radius: 22px;
      width: 95%;
      max-width: 420px;
      box-shadow: 0 8px 40px 0 rgba(0,132,240,0.18), 0 1.5px 8px 0 rgba(0,0,0,0.07);
      position: relative;
      animation: modal-content-pop 0.4s cubic-bezier(.4,0,.2,1);
    }
    @keyframes modal-content-pop {
      from { transform: scale(0.92) translateY(40px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }
    .close {
      position: absolute;
      top: 18px;
      right: 22px;
      font-size: 28px;
      color: #0084f0;
      background: #e3f0ff;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,132,240,0.08);
      transition: background 0.18s, color 0.18s, transform 0.18s;
    }
    .close:hover {
      background: #0084f0;
      color: #fff;
      transform: scale(1.08) rotate(90deg);
    }
    .modal-content h2 {
      text-align: center;
      color: #0084f0;
      font-weight: 900;
      margin-bottom: 18px;
      font-size: 1.35rem;
      letter-spacing: 1px;
    }
    .modal-content label {
      color: #005fa3;
      font-weight: 600;
    }
    .modal-content button[type="submit"] {
      width: 100%;
      margin-top: 18px;
      background: linear-gradient(90deg, #0084f0 60%, #00c6fb 100%);
      color: #fff;
      font-weight: 800;
      font-size: 1.05rem;
      border: none;
      border-radius: 8px;
      padding: 12px 0;
      box-shadow: 0 2px 8px rgba(0,132,240,0.10);
      transition: background 0.2s, transform 0.2s;
      cursor: pointer;
    }
    .modal-content button[type="submit"]:hover {
      background: linear-gradient(90deg, #005fa3 60%, #0084f0 100%);
      transform: translateY(-2px) scale(1.02);
    }
</style>

<script>
    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      document.getElementById("openMoodModal").onclick = function() {
        document.getElementById('moodModal').style.display = 'block';
      };
    // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ IP
      async function detectCity() {
        try {
          const res = await fetch('https://ipapi.co/json/');
          const data = await res.json();
          if(data && data.city) {
            document.getElementById('location').value = data.city;
          } else {
            document.getElementById('location').value = '–ì—Ä–æ–∑–Ω—ã–π';
            // alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–æ—Ä–æ–¥. –í–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é.');
          }
        } catch(e) {
          document.getElementById('location').value = '–ì—Ä–æ–∑–Ω—ã–π';
          // alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –≥–æ—Ä–æ–¥–∞.');
        }
      }
      document.getElementById('detectLocation').onclick = detectCity;
      // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('DOMContentLoaded', function() {
        document.getElementById('location').value = '–ì—Ä–æ–∑–Ω—ã–π';
        detectCity();
      });
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ –∞–Ω–∫–µ—Ç–µ
      document.getElementById("moodForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const q1 = formData.get('q1');
        const q2 = formData.getAll('q2');
        const q3 = Number(formData.get('q3'));
        const q4 = formData.get('q4');
        const q5 = formData.get('q5');
        const q6 = formData.get('q6');
        // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
        let mood = '';
        if(q1 === '–ü–ª–æ—Ö–æ' || q2.includes('–ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è') || q2.includes('–£—Å—Ç–∞–ª–æ—Å—Ç—å') || q3 <= 3 || q5 === '–≤—ã—Å–æ–∫–∏–π') {
          mood = '–ù—É–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞';
        } else if(q1 === '–û—Ç–ª–∏—á–Ω–æ' && q2.includes('–†–∞–¥–æ—Å—Ç—å') && q3 >= 8 && q5 === '–Ω–∏–∑–∫–∏–π') {
          mood = '–û—Ç–ª–∏—á–Ω–æ–µ';
        } else if(q2.includes('–≠–Ω–µ—Ä–≥–∏—è') && q3 >= 7 && q5 !== '–≤—ã—Å–æ–∫–∏–π') {
          mood = '–≠–Ω–µ—Ä–≥–∏—á–Ω–æ–µ';
        } else if(q2.includes('–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ') && q4 === '—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–æ–µ' && q5 !== '–≤—ã—Å–æ–∫–∏–π') {
          mood = '–°–ø–æ–∫–æ–π–Ω–æ–µ';
        } else if(q6 === '–¥–∞' && q1 !== '–ü–ª–æ—Ö–æ') {
          mood = '–û—Ç–∫—Ä—ã—Ç –∫ –æ–±—â–µ–Ω–∏—é';
        } else {
          mood = '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ';
        }
        document.getElementById('mood').value = mood;
        document.getElementById('moodModal').style.display = 'none';
      });
    <!--// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π-->
    <!--  document.getElementById("recommendationForm").addEventListener("submit", function(e) {-->
    <!--    e.preventDefault();-->
    <!--    const formData = new FormData(this);-->
    <!--    let result = '–í–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:\n';-->
    <!--    for (let [key, value] of formData.entries()) {-->
    <!--      result += `${key}: ${value}\n`;-->
    <!--    }-->
    <!--    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å API –ø–æ–≥–æ–¥—ã –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π-->
    <!--    document.getElementById('recommendationResult').style.display = 'block';-->
    <!--    document.getElementById('recommendationResult').innerText = result + '\n(–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤–∞—à–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)';-->
    <!--  });-->
</script>
{% endblock %}