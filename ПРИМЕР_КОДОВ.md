–û—Ç–ª–∏—á–Ω–æ, –ò–±—Ä–∞–≥–∏–º! –¢—ã –≤—ã–±—Ä–∞–ª –≥—Ä–∞–º–æ—Ç–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∏ —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å –æ—Ç –∏–¥–µ–∏ –¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

---

## üîß –ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å (TL;DR)

**–ü—Ä–æ–µ–∫—Ç:** –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ FastAPI, —Å HTML-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (Jinja2), –≥–¥–µ:

* ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.
* üë§ –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–π—Ç–∏ –∞–Ω–∫–µ—Ç—É: –≥–æ—Ä–æ–¥, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤–æ–∑—Ä–∞—Å—Ç, –∏–º—è.
* üßæ –ò–º–µ–µ—Ç—Å—è –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.
* üõ° –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
* üèô –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¢–û–ü-–º–µ—Å—Ç –≤ —Å–≤–æ—ë–º –≥–æ—Ä–æ–¥–µ.

---

## üì¶ –°—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                       |
| ---------------- | -------------------------------- |
| Backend API      | FastAPI (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)            |
| ORM              | SQLAlchemy (async) + `aiosqlite` |
| –ë–î               | SQLite                           |
| –®–∞–±–ª–æ–Ω—ã/Frontend | Jinja2 + HTML/CSS                |
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è      | JWT (Bearer Token) –∏–ª–∏ –∫—É–∫–∏      |
| UI               | Jinja2 (–µ—Å–ª–∏ –±–µ–∑ SPA)            |

---

## üîç –û—Ç–ª–∏—á–∏—è **FastAPI async** –æ—Ç **Flask** (–∫—Ä–∞—Ç–∫–æ)

| –ü—É–Ω–∫—Ç              | Flask (Sync)                 | FastAPI (Async)                 |
| ------------------ | ---------------------------- | ------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `async`  | –ù–µ—Ç (–∫–æ—Å—Ç—ã–ª—å–Ω–æ)              | –ü–æ–ª–Ω–∞—è native –ø–æ–¥–¥–µ—Ä–∂–∫–∞         |
| –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è docs | –ù–µ—Ç (—á–µ—Ä–µ–∑ Swagger –æ—Ç–¥–µ–ª—å–Ω–æ) | –î–∞ (`/docs`, `/redoc`)          |
| –°–∫–æ—Ä–æ—Å—Ç—å           | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º I/O    | –ë—ã—Å—Ç—Ä–µ–µ –∑–∞ —Å—á—ë—Ç `async`         |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö   | –†—É—á–Ω–∞—è (`wtforms`, etc.)     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–µ—Ä–µ–∑ `Pydantic` |
| IDE-–ø–æ–¥—Å–∫–∞–∑–∫–∏      | –ú–µ–Ω—å—à–µ                       | –ú–Ω–æ–≥–æ –∞–≤—Ç–æ–ø–æ–¥—Å–∫–∞–∑–æ–∫             |

---

## üìã –ü–õ–ê–ù –†–ê–ó–†–ê–ë–û–¢–ö–ò

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project/
‚îÇ
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crud.py
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moderator.py
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ schemas/
‚îÇ       ‚îî‚îÄ‚îÄ user.py
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## üß† –≠—Ç–∞–ø—ã –∏ –ø—Ä–∏–º–µ—Ä—ã

---

### 1. üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pip install fastapi uvicorn jinja2 aiofiles python-multipart aiosqlite sqlalchemy asyncpg passlib[bcrypt] python-jose
```

---

### 2. üóÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (async)

`database.py`

```python
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker
from sqlalchemy.orm import declarative_base

DATABASE_URL = "sqlite+aiosqlite:///./test.db"

engine = create_async_engine(DATABASE_URL, echo=True)
AsyncSession = async_sessionmaker(engine, expire_on_commit=False)
Base = declarative_base()
```

---

### 3. üë§ –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

`models/user.py`

```python
from sqlalchemy import Column, String, Integer, Boolean
from app.db.database import Base

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    username = Column(String, unique=True)
    password_hash = Column(String)
    is_moderator = Column(Boolean, default=False)
    city = Column(String, nullable=True)
    mood = Column(String, nullable=True)
    age = Column(Integer, nullable=True)
    full_name = Column(String, nullable=True)
```

---

### 4. üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)

* —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–µ—à –ø–∞—Ä–æ–ª—è
* –ª–æ–≥–∏–Ω ‚Üí –≤—ã–¥–∞—ë–º JWT –∏–ª–∏ –∫—É–∫—É

`auth.py (—á–∞—Å—Ç—å)`

```python
from fastapi import APIRouter, Depends, Form, Request
from app.db.crud import create_user, authenticate_user
from fastapi.responses import RedirectResponse

router = APIRouter()

@router.post("/register")
async def register_user(username: str = Form(), password: str = Form()):
    await create_user(username, password)
    return RedirectResponse("/login", status_code=302)

@router.post("/login")
async def login(username: str = Form(), password: str = Form()):
    user = await authenticate_user(username, password)
    if user:
        # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ cookie –∏–ª–∏ header
        return {"token": "jwt_token_here"}
    return {"error": "Invalid credentials"}
```

---

### 5. üßæ –ê–Ω–∫–µ—Ç–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

* –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ, –µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É.

```html
<form method="post">
  <input name="city">
  <input name="mood">
  <input name="age">
  <input name="full_name">
  <button>Submit</button>
</form>
```

---

### 6. üë®‚Äçüíº –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞

* –ü—Ä–æ–≤–µ—Ä—è–µ–º `is_moderator`
* –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

`moderator.py`

```python
@router.get("/moderator/users")
async def list_users(current_user: User = Depends(is_moderator_check)):
    return await get_all_users()
```

---

### 7. üìç –¢–û–ü-–º–µ—Å—Ç –≤ –≥–æ—Ä–æ–¥–µ

–ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `places.json`, –ø–æ—Ç–æ–º –∏—Å–∫–∞—Ç—å –ø–æ `user.city`.

–ü—Ä–∏–º–µ—Ä:

```python
@router.get("/my-city-places")
async def get_places(user: User = Depends(get_current_user)):
    places = load_places(user.city)  # top 10-50
    return templates.TemplateResponse("places.html", {"places": places})
```

---

### 8. üåê –®–∞–±–ª–æ–Ω—ã Jinja2

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤:

```python
from fastapi.templating import Jinja2Templates
templates = Jinja2Templates(directory="app/templates")
```

–ü—Ä–∏–º–µ—Ä —à–∞–±–ª–æ–Ω–∞:

```html
<h1>Welcome, {{ user.full_name }}</h1>
<p>Your mood: {{ user.mood }}</p>
```

---

## üìò –ß—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –ø–æ—à–∞–≥–æ–≤–æ

| –®–∞–≥ | –ß—Ç–æ –≤—ã—É—á–∏—Ç—å                             | –ü—Ä–∏–º–µ—Ä                            |
| --- | --------------------------------------- | --------------------------------- |
| 1   | FastAPI routing + Jinja2 templates      | `/register`, `/login`, `/profile` |
| 2   | `SQLAlchemy async + aiosqlite`          | –ú–æ–¥–µ–ª—å `User`, –∑–∞–ø—Ä–æ—Å—ã            |
| 3   | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è JWT –∏–ª–∏ –∫—É–∫–∏                | –í—Ö–æ–¥, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞             |
| 4   | Middleware –∏–ª–∏ `Depends(...)` –¥–ª—è —Ä–æ–ª–µ–π | `moderator_only`                  |
| 5   | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS (—á–µ—Ä–µ–∑ `/static/`)      | –°—Ç–∏–ª–∏ —à–∞–±–ª–æ–Ω–æ–≤                    |
| 6   | –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON –∏–ª–∏ API (–≥–æ—Ä–æ–¥–∞)   | `places_by_city()`                |

---

## ‚è≠Ô∏è –•–æ—á–µ—à—å –¥–∞–ª—å—à–µ?

–Ø –º–æ–≥—É:

* –ù–∞—á–∞—Ç—å —Å `main.py`, `models`, –∏ `auth` —Ä–æ—É—Ç–æ–≤.
* –ü–æ—Ç–æ–º ‚Äî —Ñ–æ—Ä–º—É –∞–Ω–∫–µ—Ç—ã.
* –ü–æ—Ç–æ–º ‚Äî –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
* –ü–æ—Ç–æ–º ‚Äî –≥–æ—Ä–æ–¥–∞ –∏ –º–µ—Å—Ç–∞.

---

## ‚ùì–í–æ–ø—Ä–æ—Å—ã –∫ —Ç–µ–±–µ

1. –¢–µ–±–µ —É–¥–æ–±–Ω–µ–µ JWT —Ç–æ–∫–µ–Ω (–≤ header) –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookies?
2. –•–æ—Ç–∏–º –ª–∏ –º—ã —Å–¥–µ–ª–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é/–ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ Jinja2 —à–∞–±–ª–æ–Ω—ã –∏–ª–∏ API —Å —Ñ—Ä–æ–Ω—Ç–æ–º?
3. –ú–µ—Å—Ç–∞ –≤ –≥–æ—Ä–æ–¥–µ ‚Äî –Ω—É–∂–Ω–æ –±—Ä–∞—Ç—å –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ø–Ω–¥–µ–∫—Å/Google) –∏–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `JSON`/—Ç–∞–±–ª–∏—Ü—É?

---

–•–æ—á–µ—à—å ‚Äî —è –Ω–∞—á–Ω—É –ø–∏—Å–∞—Ç—å –∫–æ–¥ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –ø–æ —à–∞–≥–∞–º. –° —á–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ–º?
